<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Detrend images. — detrending • detrendr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Detrend images. — detrending"><meta property="og:description" content="Correct images for bleaching (or any other effect that introduces an unwanted
trend) by detrending."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">detrendr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/batch-mode.html">Batch mode</a>
    </li>
    <li>
      <a href="../articles/linescan-data.html">Linescan data</a>
    </li>
    <li>
      <a href="../articles/single-images.html">Detrending single images</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rorynolan/detrendr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detrend images.</h1>
    <small class="dont-index">Source: <a href="https://github.com/rorynolan/detrendr/blob/master/R/detrend.R" class="external-link"><code>R/detrend.R</code></a></small>
    <div class="hidden name"><code>detrending.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Correct images for bleaching (or any other effect that introduces an unwanted
trend) by <em>detrending</em>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">img_detrend_robinhood</span><span class="op">(</span><span class="va">img</span>, swaps <span class="op">=</span> <span class="st">"auto"</span>, quick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">img_detrend_rh</span><span class="op">(</span><span class="va">img</span>, swaps <span class="op">=</span> <span class="st">"auto"</span>, quick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">img_detrend_boxcar</span><span class="op">(</span><span class="va">img</span>, <span class="va">l</span>, purpose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FCS"</span>, <span class="st">"FFS"</span><span class="op">)</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">img_detrend_exp</span><span class="op">(</span></span>
<span>  <span class="va">img</span>,</span>
<span>  <span class="va">tau</span>,</span>
<span>  cutoff <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  purpose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FCS"</span>, <span class="st">"FFS"</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">img_detrend_polynom</span><span class="op">(</span><span class="va">img</span>, <span class="va">degree</span>, purpose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FCS"</span>, <span class="st">"FFS"</span><span class="op">)</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-img">img<a class="anchor" aria-label="anchor" href="#arg-img"></a></dt>
<dd><p>A 4-dimensional array in the style of an
<a href="https://docs.ropensci.org/ijtiff/reference/ijtiff_img.html" class="external-link">ijtiff_img</a> (indexed by <code>img[y, x, channel, frame]</code>)
or a 3-dimensional array which is a single channel of an
<a href="https://docs.ropensci.org/ijtiff/reference/ijtiff_img.html" class="external-link">ijtiff_img</a> (indexed by <code>img[y, x, frame]</code>).</p></dd>


<dt id="arg-swaps">swaps<a class="anchor" aria-label="anchor" href="#arg-swaps"></a></dt>
<dd><p>The number of swaps (giving of one count from rich to poor) to
perform during the <em>Robin Hood</em> detrending. Set this to "auto" (the
default) to use Nolan's algorithm to automatically find a suitable value
for this parameter (recommended). For multi-channel images, it is possible
to have a different <code>swaps</code> for each channel by specifying <code>swaps</code> as a
vector or list.</p></dd>


<dt id="arg-quick">quick<a class="anchor" aria-label="anchor" href="#arg-quick"></a></dt>
<dd><p>If <code>FALSE</code> (the default), the swap finding routine is run
several times to get a consensus for the best parameter. If <code>TRUE</code>, the
swap finding routine is run only once.</p></dd>


<dt id="arg-l">l<a class="anchor" aria-label="anchor" href="#arg-l"></a></dt>
<dd><p>The length parameter for <em>boxcar</em> detrending. The size of the
sliding window will be <code>2 * l + 1</code>. This must be a positive integer. Set
this to "auto" to use Nolan's algorithm to automatically find a suitable
value for this parameter (recommended). For multi-channel images, it is
possible to have a different <code>l</code> for each channel by specifying <code>l</code> as a
vector or list.</p></dd>


<dt id="arg-purpose">purpose<a class="anchor" aria-label="anchor" href="#arg-purpose"></a></dt>
<dd><p>What type of calculation do you intend to perform on the
detrended image? If it is an FFS (fluorescence fluctuation spectroscopy)
calculation (like number and brightness), choose 'FFS'. If it is an FCS
(fluorescence correlation spectroscopy) calculation (like cross-correlated
number and brightness or autocorrelation), choose 'FCS'. The difference is
that if <code>purpose</code> is 'FFS', the time series is corrected for non-stationary
mean and variance, whereas if <code>purpose</code> is 'FCS', the time series is
corrected for non-stationary mean only. <code>purpose</code> is not required for
<em>Robin Hood</em> detrending.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Would you like to use multiple cores to speed up this
function? If so, set the number of cores here, or to use all available
cores, use <code>parallel = TRUE</code>.</p></dd>


<dt id="arg-tau">tau<a class="anchor" aria-label="anchor" href="#arg-tau"></a></dt>
<dd><p>The \(tau\) parameter for <em>exponential filtering</em> detrending.
This must be a positive number. Set this to "auto" to use Nolan's algorithm
to automatically find a suitable value for this parameter (recommended).
For multi-channel images, it is possible to have a different <code>tau</code> for each
channel by specifying <code>tau</code> as a vector or list.</p></dd>


<dt id="arg-cutoff">cutoff<a class="anchor" aria-label="anchor" href="#arg-cutoff"></a></dt>
<dd><p>In <em>exponential filtering</em> detrending, for the weighted
average, every point gets a weight. This can slow down the computation
massively. However, many of the weights will be approximately zero. With
cutoff, we say that any point with weight less than or equal to <code>cutoff</code>
times the maximum weight may be ignored; so with <code>cutoff = 0.05</code>, any
weight less than 5\<!-- % of the maximum weight may be ignored. The default -->
value of this parameter is sensible and its value should not be set to
anything else without good reason.</p></dd>


<dt id="arg-degree">degree<a class="anchor" aria-label="anchor" href="#arg-degree"></a></dt>
<dd><p>The degree of the polynomial to use for the polynomial
detrending. This must be a positive integer. Set this to "auto" to use
Nolan's algorithm to automatically find a suitable value for this parameter
(recommended). For multi-channel images, it is possible to have a different
<code>degree</code> for each channel by specifying <code>degree</code> as a vector or list.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The detrended image, an object of class <a href="detrended_img.html">detrended_img</a>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>There are 4 detrending methods available: <em>Robin Hood</em>, <em>boxcar</em>,
<em>exponential filtering</em> and <em>polynomial</em>. <em>Robin Hood</em> is described in Nolan
et al., 2018. The others are described in Nolan et al., 2017.</p><ul><li><p><em>Boxcar</em> detrending with parameter \(l\) is a moving average detrending
method using a sliding window of size \(2l + 1\).</p></li>
<li><p><em>Exponential
filtering</em> detrending is a moving weighted average method where for parameter
\(tau\) the weights are calculated as exp\((- t / tau)\) where \(t\) is
the distance from the point of interest.</p></li>
<li><p><em>Polynomial</em> detrending works
by fitting a polynomial line to a series of points and then correcting the
series to remove the trend detailed by this polynomial fit.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Rory Nolan, Luis A. J. Alvarez, Jonathan Elegheert, Maro
Iliopoulou, G. Maria Jakobsdottir, Marina Rodriguez-Muñoz, A. Radu
Aricescu, Sergi Padilla-Parra; nandb—number and brightness in R with a
novel automatic detrending algorithm, Bioinformatics,
https://doi.org/10.1093/bioinformatics/btx434.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## These examples are not run on CRAN because they take too long.</span></span></span>
<span class="r-in"><span><span class="co">## You can still try them for yourself.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">ijtiff</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/ijtiff/reference/read_tif.html" class="external-link">read_tif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"bleached.tif"</span>,</span></span>
<span class="r-in"><span>  package <span class="op">=</span> <span class="st">"detrendr"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_rh</span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_boxcar</span><span class="op">(</span><span class="va">img</span>, <span class="st">"auto"</span>, purpose <span class="op">=</span> <span class="st">"fcs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected10</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_boxcar</span><span class="op">(</span><span class="va">img</span>, <span class="fl">10</span>, purpose <span class="op">=</span> <span class="st">"fcs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected50</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_boxcar</span><span class="op">(</span><span class="va">img</span>, <span class="fl">50</span>, purpose <span class="op">=</span> <span class="st">"fcs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_exp</span><span class="op">(</span><span class="va">img</span>, <span class="st">"auto"</span>, purpose <span class="op">=</span> <span class="st">"ffs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected10</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_exp</span><span class="op">(</span><span class="va">img</span>, <span class="fl">10</span>, purpose <span class="op">=</span> <span class="st">"ffs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected50</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_exp</span><span class="op">(</span><span class="va">img</span>, <span class="fl">50</span>, purpose <span class="op">=</span> <span class="st">"fcs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_polynom</span><span class="op">(</span><span class="va">img</span>, <span class="st">"auto"</span>, purpose <span class="op">=</span> <span class="st">"ffs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">corrected2</span> <span class="op">&lt;-</span> <span class="fu">img_detrend_polynom</span><span class="op">(</span><span class="va">img</span>, <span class="fl">2</span>, purpose <span class="op">=</span> <span class="st">"ffs"</span>, parallel <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rory Nolan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

